<!DOCTYPE html>
<html>
  <head>
    <title>SOLIBINS :)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="app.min.css">
    <link rel="stylesheet" href="./css/w3.css">
    <link rel="stylesheet" href="./css/w3-theme-indigo.css">
    <link rel="stylesheet" href="./css/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
      body
  {
    background-color: #d1e6ee;
background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25' viewBox='0 0 1200 800'%3E%3Cdefs%3E%3CradialGradient id='a' cx='0' cy='800' r='800' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0' stop-color='%23c7edff'/%3E%3Cstop offset='1' stop-color='%23c7edff' stop-opacity='0'/%3E%3C/radialGradient%3E%3CradialGradient id='b' cx='1200' cy='800' r='800' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0' stop-color='%23c9d4dd'/%3E%3Cstop offset='1' stop-color='%23c9d4ff' stop-opacity='0'/%3E%3C/radialGradient%3E%3CradialGradient id='c' cx='600' cy='0' r='600' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0' stop-color='%23c0daff'/%3E%3Cstop offset='1' stop-color='%23c0daff' stop-opacity='0'/%3E%3C/radialGradient%3E%3CradialGradient id='d' cx='600' cy='800' r='600' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0' stop-color='%23d1e6ff'/%3E%3Cstop offset='1' stop-color='%23d1e6ff' stop-opacity='0'/%3E%3C/radialGradient%3E%3CradialGradient id='e' cx='0' cy='0' r='800' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0' stop-color='%23bdf8ff'/%3E%3Cstop offset='1' stop-color='%23bdf8ff' stop-opacity='0'/%3E%3C/radialGradient%3E%3CradialGradient id='f' cx='1200' cy='0' r='800' gradientUnits='userSpaceOnUse'%3E%3Cstop offset='0' stop-color='%23c5c2ff'/%3E%3Cstop offset='1' stop-color='%23c5c2ff' stop-opacity='0'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect fill='url(%23a)' width='1200' height='800'/%3E%3Crect fill='url(%23b)' width='1200' height='800'/%3E%3Crect fill='url(%23c)' width='1200' height='800'/%3E%3Crect fill='url(%23d)' width='1200' height='800'/%3E%3Crect fill='url(%23e)' width='1200' height='800'/%3E%3Crect fill='url(%23f)' width='1200' height='800'/%3E%3C/svg%3E");
background-attachment: fixed;
background-size: cover;
background-position: center;
  }
    </style>
  </head>

  <body>
    <div class="app-page" data-page="home">
      <div class="app-topbar w3-theme-d1">
        <div class="app-title w3-center">SOLIBINS</div>
      </div>
      <div class="app-content w3-theme-l5">

        <div class="w3-row-padding" style="">
          <br><br>
          <p>
                                        <div class="w3-col s4 w3-left">Nb. tirages </div>
                                        <button class="w3-col s2 w3-theme-l4 w3-margin-right w3-round-large w3-riffle w3-center" style="width: 30px; padding-right: 3px; padding-left: 3px;" onclick="decrementNbTirages();"><b>-</b></button>
                                        <span class="w3-col s4" id="nbTiragesText">5 tirages</span>
                                        <button class="w3-col s2 w3-theme-l4 w3-margin-right w3-round-large w3-riffle w3-center" style="width: 30px; padding-right: 3px; padding-left: 3px;" onclick="incrementNbTirages();"><b>+</b></button>

            </p>
            <br>
                                        
        </div>

        <div class="w3-row-padding" style="">
          <br><br>
          <p>
                                        <div class="w3-col s4 w3-left">Chrono </div>
                                        <button class="w3-col s2 w3-theme-l4 w3-margin-right w3-round-large w3-riffle w3-center" style="width: 30px; padding-right: 3px; padding-left: 3px;" onclick="YesOrNoChrono();"><b>-</b></button>
                                        <span class="w3-col s4" id="YesOrNoChronoText">Non</span>
                                        <button class="w3-col s2 w3-theme-l4 w3-margin-right w3-round-large w3-riffle w3-center" style="width: 30px; padding-right: 3px; padding-left: 3px;" onclick="YesOrNoChrono();"><b>+</b></button>

            </p>
            <br>
                                        
        </div>

        <div class="app-section">
          <div class="app-button blue" onclick="App.load('tiragesshowcase', {lg: 4})">4 LETTRES</div>
        </div>

        <div class="app-section">
          <div class="app-button blue" onclick="App.load('tiragesshowcase', {lg: 5})">5 LETTRES</div>
        </div>

        <div class="app-section">
          <div class="app-button blue" onclick="App.load('tiragesshowcase', {lg: 6})">6 LETTRES</div>
        </div>

        <div class="app-section">
          <div class="app-button w3-blue" onclick="App.load('tiragesshowcase', {lg: 7})">7 LETTRES</div>
        </div>

        <div class="app-section">
          <div class="app-button w3-blue" onclick="App.load('tiragesshowcase', {lg: 8})">8 LETTRES</div>
        </div>
      </div>
    </div>

    <div class="app-page" data-page="tiragesshowcase">
      <div class="app-topbar">
        <div class="app-button left" onclick="App.load('home')">Retour</div>
        <div class="app-title"><em id="titleshowcasetxt">4 lettres</em></div>
      </div>
      <div class="app-content">
       <ul class="tirages app-list">
          <li class="tirage" style="vertical-align: middle; letter-spacing: 1.35pt;">
            <div class="w3-row-padding">
                <div class="tir w3-col s6 w3-left">
                </div>

                <div class="essai w3-col s6 w3-text-blue w3-right">
                </div>
            </div>
          </li>
      </ul>

      <div class="w3-display-bottommiddle" style="position: fixed; bottom: 2px;">
          <div class="app-button w3-theme w3-padding" style="width: 100%;" data-target="correction">CORRIGER</div>
      </div>
      </div>
    </div>

    <div class="app-page" data-page="proposition">
      <div class="app-content  w3-light-blue">
        <div class="app-topbar">
            <div class="app-button left w3-black" onclick="App.load('tiragesshowcase', {lg: 0})"><</div>
           <div class="app-title"><em>Proposition</em></div>
        </div>
        <br><br>
        <div class="w3-right w3-margin-right">Tirage nÂ° <span id="numTirageActuel"></span> / <span id="numTiragesTotal"></span></div>
          <br><br>
          <div class="w3-center" id="espaceTirage">
            
          </div>
          <br><br>
          <div id="espacePropo" class="w3-center">
            
          </div>

          <br><br>
          <div class="app-button w3-center w3-theme-l1 w3-ripple" id="passerOuValiderBtn" style="width:40%;">Passer</div>

      </div>
    </div>

    <div class="app-page" data-page="correction">
      <div class="app-content  w3-light-blue">
        <div class="app-topbar">
        <div class="app-button w3-black" onclick="location.reload();">Accueil</div>
        <div class="w3-center" style="margin: 0 auto;"><b>Solution</b></div>
      </div>
        <br><br>

        <div class="solutionstirages app-section">
          <div class="solutiontirage w3-container" style="vertical-align: middle; letter-spacing: 1pt;">
            <div class="w3-row-padding">
                <div class="tirpoursol w3-col s4 w3-left">
                </div>

                <div class="propotir w3-col s4">
                </div>

                <div class="soltir w3-col s4 w3-text-green w3-right">
                </div>
            </div>
            
            
          </div>

          
      </div>
        <br><br><br>
               <div class="app-content w3-theme-l2 w3-padding">
                   <div class="w3-large w3-round-large w3-center" style="display: block;" id="scoreDiv">Votre score: <span class="w3-xxlarge w3-text-green w3-light-blue w3-padding w3-round-large" id="scoreExo" style="font-weight: 900;"></span></div>
               </div>

      </div>
    </div>

    <script src="zepto.js"></script>
    <script src="app.min.js"></script>
    <script src="solibin4.js"></script>
    <script src="solibin5.js"></script>
    <script src="solibin6.js"></script>
    <script src="solibin7.js"></script>
    <script src="solibin8.js"></script>

    <script>
      App.controller('home', function (page) {
          SESSION_FINIE = true;
      });

      App.controller('tiragesshowcase', function (page, data) {
          
          var l = data.lg != 0 ? Number(data.lg): TABSESSION[0].id.length;

          if(SESSION_FINIE)
          {
            TABSESSION = shuffle(soliBinTab(l)).slice(0, NBTIRAGES);
            propoTabs = [];
            for(var ii=0; ii<NBTIRAGES; ii++)
                 propoTabs.push("");
            SESSION_FINIE = false;
          }
          
          var stringL = l + " lettres - " + NBTIRAGES + " tirages";

           $(page).find("#titleshowcasetxt").text(stringL);

            var $template = $(page).find('.tirage').remove();
            var $tirages = $(page).find('.tirages');
            TABSESSION.forEach(function (tirage, i, arr) {
            var $tirage = $template.clone(true);
            var affich = arr[i].hasOwnProperty("ana") ? arr[i]["ana"]: arr[i]["id"].split("").sort().join("");
            if(arr[i].hasOwnProperty("ana"))
               $tirage.find('.tir').html("<h4><b>" + affich + "</b></h4>");
            else
              $tirage.find('.tir').html("<h4>" + affich + "</h4>");

            if(propoTabs[i]!="")
            {
              $tirage.find('.essai').html("<h4>" + propoTabs[i] + "</h4>");
            }
            else
            {
              $tirage.find('.essai').html("");
            }

            $tirage.on('click', function (){
               App.load('proposition', {tirage: affich, num:i});
            });
            $tirages.append($tirage);
         });
        
      });


      App.controller('proposition', function (page, data) {


        tirage = data.tirage;
        essaiPropo = propoTabs[data.num];

        function afficherTirage(tirage, propo)
{
  if(propo == "")
  {
     $(page).find('#espaceTirage').html(drawWord(tirage));
     $(page).find('#espacePropo').html("");
  }

  else
  {
     afficherTirage(tirage, "");
     var tgdupli = tirage;
     var tabPps = propo.split("");
     tabPps.forEach(l => {tgdupli = tgdupli.replace(l, "")});


     var tabTirs = tirage.split("");
     tabTirs.forEach(ll => {
        desactiverLettreDuTirage(ll);
     });

     var tabTirsRest = tgdupli.split("");
     tabTirsRest.forEach(ll => {
        activerLettreDuTirage(ll);
     })

     

     afficherPropo(propo);
  }
}

function afficherPropo(propo)
{
  if(propo.length > 0)
    document.getElementById("espacePropo").innerHTML = drawWordPropo(propo);

  else
    document.getElementById("espacePropo").innerHTML = "";
}

function desactiverLettreDuTirage(lt)
{

  var num = 0;
  var idl = lt + "" + num;


  while(document.getElementById(idl) == null || !isActive(idl))
  {
      num++;
      idl = lt + "" + num;

      if(num == 16)
        break;
  }

  if(document.getElementById(idl) != null)
  {
      document.getElementById(idl).style.color = "gray";
      document.getElementById(idl).style.backgroundColor =  "rgba(200, 250, 200, 0.3)";
  }
}

function activerLettreDuTirage(lt)
{
  var num = 0;
  var idl = lt + "" + num;


  while(document.getElementById(idl) == null || isActive(idl))
  {
      num++;
      idl = lt + "" + num;
  }

  if(document.getElementById(idl) != null)
  {
    document.getElementById(idl).style.color = "black";
    document.getElementById(idl).style.backgroundColor =  "rgba(160, 250, 200, 0.8)";
  }
  
  
}

function isActive(idl)
{
  return document.getElementById(idl)!= null && document.getElementById(idl).style.color == "black";
}

document.addEventListener("click", function(e){
  if(e.target && e.target.id)
    {

      var id = e.target.id;

      if(id.length == 2)
      {
        var deactivated = !isActive(id);
        if(!deactivated)
        {
          essaiPropo += id[0];
          propoTabs[data.num] = essaiPropo;
          afficherTirage(tirage, essaiPropo);
          desactiverLettreDuTirage(id);
        }
        
      }

      else
      {
        if(id.startsWith("propo"))
        {
          var lt = id.split("propo")[1][0];
          essaiPropo = essaiPropo.replace(lt, "");
          propoTabs[data.num] = essaiPropo;
          activerLettreDuTirage(lt);
          afficherPropo(essaiPropo);
        }
      }
    }
});

        function setPropo(dt)
        {
          
          tirage = dt.tirage;
          essaiPropo = propoTabs[dt.num];


          afficherTirage(tirage, essaiPropo);
          var n = Number(dt.num) + 1;
          $(page).find('#numTirageActuel').text(n);
          $(page).find('#numTiragesTotal').text(NBTIRAGES);
          

          $(page).find('#passerOuValiderBtn').on('click', function(){
                console.log(n-1);
                 console.log(essaiPropo);
                 propoTabs[n-1] = essaiPropo;
                 var numActuel = Number(dt.num);
                 var nextNum = numActuel == NBTIRAGES-1 ? 0: numActuel+1;
                 var affich = TABSESSION[nextNum].hasOwnProperty("ana") ? TABSESSION[nextNum]["ana"]: TABSESSION[nextNum]["id"].split("").sort().join("");


                 setPropo({tirage: affich, num: nextNum});

          })
        }

        setPropo(data);
        
      });


      App.controller('correction', function (page) {

        var $template = $(page).find('.solutiontirage').remove();
        var $solutionstirages = $(page).find('.solutionstirages');

        var sf = 0;

        

        TABSESSION.forEach(function (tirage, i, arr) {
            var $solutiontirage = $template.clone(true);
            var affich = arr[i].hasOwnProperty("ana") ? arr[i]["ana"]: arr[i]["id"].split("").sort().join("");
            if(arr[i].hasOwnProperty("ana"))
               $solutiontirage.find('.tirpoursol').html("<span><b>" + affich + "</b></span>");
            else
              $solutiontirage.find('.tirpoursol').html("<span>" + affich + "</span>");

            var aTrouve = propoTabs[i] == TABSESSION[i]['id'];

            if(aTrouve)
            {
              sf++;
              $solutiontirage.find('.propotir').html("<span class='w3-medium' style='width: 100%; margin: auto;'>" + " = " + "</span>");
            }
            else
            {
                $solutiontirage.find('.propotir').html("<span class='w3-text-red' style='font-size: 13px;'><s>" + propoTabs[i] + "</s></span>");
            }

            $solutiontirage.find('.soltir').html("<div class='w3-text-green'><b>" + TABSESSION[i]["id"] + "</b></div>");
            $solutionstirages.append($solutiontirage);
         });

        $(page).find('#scoreExo').text(sf + " / " + TABSESSION.length);


      });

      try {
        App.restore();
      } catch (err) {
        App.load('home');
      }
    </script>

    <script>

var NBTIRAGES = 5;
var LGTH = 5;
var YES_OR_NO_CHRONO = false;
var propoTabs = [];
for(var ii=0; ii<NBTIRAGES; ii++)
    propoTabs.push("");
var TABSESSION = soliBinTab(4);

var SESSION_FINIE = true;
TABSESSION = shuffle(soliBinTab(4)).slice(0, NBTIRAGES);

var tirage = "";
var essaiPropo = "";


function shuffle(a) {
    var j, x, i;
    for (i = a.length - 1; i > 0; i--) {
        j = Math.floor(Math.random() * (i + 1));
        x = a[i];
        a[i] = a[j];
        a[j] = x;
    }
    return a;
}

function loadTirages()
{

}


function soliBinTab(l)
{
  if(l==4)
    return tabSoliBin4;
  if(l==5)
    return tabSoliBin5;
  if(l==6)
    return tabSoliBin6;
  if(l==7)
    return tabSoliBin7;
  if(l==8)
    return tabSoliBin8;

  LGTH = l;

  return [];
}
function incrementNbTirages()
{
   if(NBTIRAGES >= 100)
      NBTIRAGES = 5;
   else
    NBTIRAGES += 5;

  propoTabs = [];
for(var ii=0; ii<NBTIRAGES; ii++)
      propoTabs.push("");
  TABSESSION = shuffle(soliBinTab(8)).slice(0, NBTIRAGES);

  document.getElementById('nbTiragesText').textContent = NBTIRAGES + " tirages";

}

function decrementNbTirages()
{
   if(NBTIRAGES <= 5)
      NBTIRAGES = 100;
   else
    NBTIRAGES -= 5;

  propoTabs = [];
  for(var ii=0; ii<NBTIRAGES; ii++)
        propoTabs.push("");
  TABSESSION = shuffle(soliBinTab(8)).slice(0, NBTIRAGES);
  document.getElementById('nbTiragesText').textContent = NBTIRAGES + " tirages";

    
}

function YesOrNoChrono()
{
  YES_OR_NO_CHRONO = !YES_OR_NO_CHRONO;
  document.getElementById("YesOrNoChronoText").textContent = YES_OR_NO_CHRONO ? 'Oui':'Non';

}

function drawLetter(ltr, i)
{

      return `<span id='${ltr + "" + i}' class='w3-bordered w3-round-medium w3-xxlarge w3-card-2' style='padding:5px; margin-right:2px; background-color:rgba(160, 250, 200, 0.8); color:black; font-weight:bold; cursor:pointer;'>${ltr}</span>`;
  
}

function drawLetterPropo(ltr, i)
{

      return `<span id='propo${ltr + "" + i}' class='w3-bordered w3-round-medium w3-xxlarge w3-card-2' style='padding:5px; margin-right:2px; background-color:rgba(160, 250, 200, 0.8); color:black; font-weight:bold; cursor:pointer;'>${ltr}</span>`;
  
}

function drawWord(wd)
{
  if(wd.length != 0)
  {
    var tab = wd.split('');
    var ch = "";
    tab.forEach((l, i) => ch += drawLetter(l, i));
    return ch;
  }

  return "";
  
} 

function drawWordPropo(wd)
{
  var tab = wd.split('');
  var ch = "";
  tab.forEach((l, i) => ch += drawLetterPropo(l, i));
  return ch;
} 






    </script>
  </body>
</html>
